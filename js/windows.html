<script>
let highestZ = 10;

document.querySelectorAll("[data-window]").forEach(windowEl => {
  const header = windowEl.querySelector("[data-window-header]");

  let isDragging = false;
  let offsetX = 0;
  let offsetY = 0;

  // Bring window to front
  function focusWindow() {
    highestZ++;
    windowEl.style.zIndex = highestZ;
  }

  header.addEventListener("mousedown", (e) => {
    isDragging = true;
    focusWindow();

    offsetX = e.clientX - windowEl.offsetLeft;
    offsetY = e.clientY - windowEl.offsetTop;

    document.body.style.userSelect = "none";
  });

  document.addEventListener("mousemove", (e) => {
    if (!isDragging) return;

    const windowWidth = windowEl.offsetWidth;
    const windowHeight = windowEl.offsetHeight;

    const maxX = window.innerWidth - windowWidth;
    const maxY = window.innerHeight - windowHeight;

    let newX = e.clientX - offsetX;
    let newY = e.clientY - offsetY;

    // Bounds
    newX = Math.max(0, Math.min(newX, maxX));
    newY = Math.max(0, Math.min(newY, maxY));

    windowEl.style.left = `${newX}px`;
    windowEl.style.top = `${newY}px`;
  });

  document.addEventListener("mouseup", () => {
    isDragging = false;
    document.body.style.userSelect = "";
  });

  // Click anywhere on window focuses it
  windowEl.addEventListener("mousedown", focusWindow);
});
</script>